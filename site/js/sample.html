<!DOCTYPE html>
<html>
  <head>
    <style>
       #map {
        height: 800px;
        width: 100%;
       }
    </style>
  </head>
  <body>
    <h3>My Google Maps Demo</h3>
    <div id="map"></div>
    <a href = "#" onClick = "loadTable()"> Show me the table</a>	  
    <script>
	var map;
	function initMap() {
        	var location = {lat: 55.700, lng: 37.600};
        	var uluru = {lat: -25.363, lng: 131.044};
        	map = new google.maps.Map(document.getElementById('map'), {
        	  zoom: 4,
       		  center: location
        	});
        var marker = new google.maps.Marker({
          position: uluru,
          map: map,
          draggable: true,
          animation: google.maps.Animation.DROP,
          title: 'Marker'
        });
        var marker2 = new google.maps.Marker({
          position: location,
          map: map,
          draggable: true,
          title: 'Second Marker'
        });
        var contentString = 'Hello! I am the Marker. Move me :)';
        var infowindow = new google.maps.InfoWindow({
          content: contentString
        });
        marker.addListener('click', function() {
          infowindow.open(map, marker);
       });
	marker2.addListener('click', function() {
          infowindow.open(map, marker2);
       });      
        //console.log("Test");
        //alert ("Hello! That's my map");
	      
	google.maps.event.addListener(marker, 'position_changed', update);
  	google.maps.event.addListener(marker2, 'position_changed', update);      
	      
        var flightPlanCoordinates = [
       marker.getPosition(), 
       marker2.getPosition()
        ];
        var flightPath = new google.maps.Polyline( {
        path: flightPlanCoordinates,
        geodesic: true,
	draggable: true,
        strokeColor: '#FF0000',
      	strokeOpacity: 1.0,
      	strokeWeight: 2
    } );

  	flightPath.setMap(map);
	update();
function update() {
  var path = [marker.getPosition(), marker2.getPosition()];
  flightPath.setPath(path);
}
      }  
	  </script>
	  
 <script>
    a = document.createElement("div");
    a.innerHTML = "Wait, it's loading...";
    a.style.position = "absolute";
    a.style.top = "50%";
    a.style.left = "50%";
    a.style.zIndex = 15;
    a.style.display = "none";
      function loadTable()
      {
        var xhr = new XMLHttpRequest();
	var places;
        xhr.open('GET', 'https://maptaxonomy.ru/api/v1/experiments/?format=json', true); ///maptaxonomy/sample_data/Table1.csv.json
        xhr.send();
        xhr.onreadystatechange = function()
        {
          if ((xhr.readyState > 0) && (xhr.readyState < 4))
              a.style.display = "block";
			if (xhr.readyState == 4)
			{
				a.style.display = "none";
          if (xhr.status != 200) 
          {
            // обработать ошибку
            alert( xhr.status + ': ' + xhr.statusText );
          }
          else
          {
            try
            {
              var data = JSON.parse(xhr.responseText);
              places = data.results;
		
            }
            catch (e)
            {
              alert( "Некорректный ответ: " + e.message);
		console.log(xhr.responseText);            
	    }
	  }
            showTable(places);
		}
          }
      }	
	 var columnHandlers = {};    
	 
      function showTable(places) 
    {
		var headers = {};
	    	var loc = [];
		for (place in places)
		{
			for (i in places[place])
			{
				headers[i] = 1;
			}
		}
    		t = document.createElement("table");
		tr = document.createElement("tr");
		for (header in headers)
		{
			th = document.createElement("th");
			th.innerHTML = header;
			tr.append(th);
		}
		t.append(tr);
		for (place in places)
		{
			loc[place] = {};
			tr = document.createElement("tr");
			for (header in headers)
				{
					td = document.createElement("td");
					var columnHandlers = {
				'genbank': function(x) {return 'Genbank: ' + 
	'<a  target=”_blank” href ="https://www.ncbi.nlm.nih.gov/gquery/?term=' + x + '">ссылка</a>'; },
				'latitude' : function(x) {return x},
				'longitude' : function(y) {return y},
				'position': function(x) {return 'Position: ' + x + '.'; }
			}
					if (places[place].hasOwnProperty(header))
						{
							td.innerHTML = places[place][header];
							
							}
					tr.append(td);	
				}
			t.append(tr);
		document.body.append(t);
		
		for (index in columnHandlers)
			console.log(index + '= ' + columnHandlers[index]);
		}
	    //var loc = {lat: columnHandlers['latitude'], lng: columnHandlers['longitude']};
	    var contentString = {}, info = {}, marker = {};
	for (place in places)
	{
		marker[place] = new google.maps.Marker({
		    position: {lat: places[place]['latitude'], lng: places[place]['longitude']},
		    map: map,
		    title: 'not yet'
	    });
		contentString[place] = columnHandlers['genbank'](places[place]['genbank_id']) + 
			columnHandlers['position'](places[place]['position']);
	    	info[place] = new google.maps.InfoWindow({
          content: contentString[place]
        });
	     marker[place].addListener('click', function() {
          info[place].open(map, marker[place]);
       });
	}
	} 
	/* if (header == 'Name')
								{
									var local = places[place][header].split('/');
									arr[place] = {};
									arr[place].city = local[2];
								}
								if (header == 'Country')
								{
									arr[place].country = places[place][header];
								}
								if (header == 'latitude')
									var lat = places[place][header];
								if (header == 'longitude')
									var lng = places[place][header];
								var loc = {lat: lat, lng: lng};
								if (header == 'position')
									var pos = places[place][header];
								if (header == 'genbank_id')
									var id = places[place][header];*/
    </script>  
	  
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDA6tIfdstDmqeKNMhA_tWYo4Xm0oYizc0&callback=initMap&&libraries=geometry">
    </script>
  </body>
</html>
